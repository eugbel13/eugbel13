---
- name: lessgooo

# hosts need better defined

- hosts: localhost
  user: parallels
  vars:
    environment: qa
    confl_bin: atlassian-confluence-7.4.6-64x.bin
    confl_url: https://www.atlassian.com/software/downloads/binary/{{confl_bin}}
    ansible_ssh_pipelining: true
  become: true

# paths need to be defined
# src paths would be for files hosted in the repo
# dest paths would be on the server

- tasks:
  - name: download confluence installer
    get_url:
      url: '{{confl_url}}'
      dest: /path/{{confl_bin}}
      mode: 0755
    
  - name: response.varfile
    copy:
      src: files/{{environment}}/response.varfile
      dest: /path/response.varfile
    become: true

# Learn about the 'creates'
  - name: install confluence
    command: /path/{{confl_bin}} -q -varfile /path/response.varfile
      creates=/opt/atlassian/confluence/install.reg

  - name: server.xml
    copy:
      src: files/{{environment}}/server.xml
      dest: /confluencepath/server.xml
    become: true

  - name: confluence.conf
    copy:
      src: files/{{environment}}/confluence.conf
      dest: /confluencepath/confluence.conf
    become: true

# the keystore file name would changed per environment
# I'm writing this playbook in a way that we should just need to change the environment variable in the host and most would work
# should maybe look into ways to make this easier to change
  - name: keystore
    copy:
      src: files/{{environment}}/qakb.jks
      dest: /confluencepath/qakb.jks
    become: true

# next things to consider:
# complete paths for the above
# plugins
# bulk upload folders, files, scripts